@{
    ViewBag.Title = "项目进展";
}
@Html.Partial("contenttitle", "项目进展")
@using Model
<fieldset>
    <legend>每月进度总表</legend>
    @(Html.Telerik().Grid<AjaxMonthTotalProgressStatistics>().Name("AjaxMonthTotalProgressStatistics").DataKeys(keys =>
                {
                    keys.Add(s => s.Month);
                }).Columns(c =>
                {
                    c.Bound(item => item.Month);

                    c.Bound(item => item.TotalCheckinTargets).Title("项目总CheckIn目标").Format("{0:c}").Aggregate(item => item.Sum()).ClientFooterTemplate("<p>CheckIn目标总额: <#= Sum #></p>");
                    c.Bound(item => item.TotalCheckIn).Title("项目总CheckIn").Format("{0:c}").Aggregate(item => item.Sum()).ClientFooterTemplate("<p>CheckIn总额: <#= Sum #></p>");
                    c.Bound(item => item.CheckInComplatePercetage).ClientTemplate("<p><#= CheckInComplatePercetage #>%</p>");
                    c.Bound(item => item.TotalDealinTargets).Title("项目总DeaIn目标").Format("{0:c}").Aggregate(item => item.Sum()).ClientFooterTemplate("<p>DealIn目标总额: <#= Sum #></p>");
                    c.Bound(item => item.TotalDealIn).Title("项目总DealIn").Format("{0:c}").Aggregate(item => item.Sum()).ClientFooterTemplate("<p>DealIn总额: <#= Sum #></p>");
                    c.Bound(item => item.DealInComplatePercetage).ClientTemplate("<p><#= DealInComplatePercetage #>%</p>");
                    c.Bound(item => item.MemberCounts);
                    c.Bound(item => item.LeadCallsCount).Aggregate(item => item.Sum()).ClientFooterTemplate("<p>Call总数: <#= Sum #></p>");
                    c.Bound(item => item.CallingCompanyCount).Aggregate(item => item.Sum()).ClientFooterTemplate("<p>已打公司总数: <#= Sum #></p>");
                    c.Bound(item => item.CallingLeadCount).Aggregate(item => item.Sum()).ClientFooterTemplate("<p>已打Lead总数: <#= Sum #></p>");
                    c.Bound(item => item.PerMemberCheckIn).Aggregate(item => item.Average()).ClientFooterTemplate("<p>个人平均CheckIn: <#= Average #></p>").Format("{0:c}");
                    c.Bound(item => item.PerMemberDealIn).Aggregate(item => item.Average()).ClientFooterTemplate("<p>个人平均DealIn: <#= Average #></p>").Format("{0:c}");
                    c.Bound(item => item.PerMemberCall).Aggregate(item => item.Average()).ClientFooterTemplate("<p>个人平均Call数量: <#= Average #></p>");
                })
                .DataBinding(d => d.Ajax().Select("_MonthProgress", "report"))
                .Selectable().ClientEvents(events => events.OnRowSelect("onMonthRowSelected"))
                .Resizable(resizing => resizing.Columns(true))
                    .Pageable(p => p.Style(GridPagerStyles.Status).PageOnScroll(true).PageSize(12)).Sortable()
                 .Scrollable(s => s.Height(305))

                    )
</fieldset>


<fieldset>
    <legend id="MonthWeek">@DateTime.Now.Month 月每周进度总表</legend>
    @(Html.Telerik().Grid<AjaxWeekTotalProgressStatistics>().Name("weeks")
        .DataKeys(keys =>
        {
            keys.Add(s => s.StartDayString);
            keys.Add(s => s.EndDayString);
        })
    .Columns(c =>
    {
        c.Bound(item => item.StartDayString);
        c.Bound(item => item.EndDayString);
        c.Bound(item => item.TotalCheckinTargets).Title("项目总CheckIn目标").Format("{0:c}").Aggregate(item => item.Sum()).ClientFooterTemplate("<p>CheckIn目标总额: <#= Sum #></p>");
        c.Bound(item => item.TotalCheckIn).Title("项目总CheckIn").Format("{0:c}").Aggregate(item => item.Sum()).ClientFooterTemplate("<p>CheckIn总额: <#= Sum #></p>");
        c.Bound(item => item.CheckInComplatePercetage).ClientTemplate("<p><#= CheckInComplatePercetage #>%</p>");
        c.Bound(item => item.TotalDealinTargets).Title("项目总DeaIn目标").Format("{0:c}").Aggregate(item => item.Sum()).ClientFooterTemplate("<p>DealIn目标总额: <#= Sum #></p>");
        c.Bound(item => item.TotalDealIn).Title("项目总DealIn").Format("{0:c}").Aggregate(item => item.Sum()).ClientFooterTemplate("<p>DealIn总额: <#= Sum #></p>");
        c.Bound(item => item.DealInComplatePercetage).ClientTemplate("<p><#= DealInComplatePercetage #>%</p>");
        c.Bound(item => item.MemberCounts);
        c.Bound(item => item.LeadCallsCount).Aggregate(item => item.Sum()).ClientFooterTemplate("<p>Call总数: <#= Sum #></p>");
        c.Bound(item => item.CallingCompanyCount).Aggregate(item => item.Sum()).ClientFooterTemplate("<p>已打公司总数: <#= Sum #></p>");
        c.Bound(item => item.CallingLeadCount).Aggregate(item => item.Sum()).ClientFooterTemplate("<p>已打Lead总数: <#= Sum #></p>");
        c.Bound(item => item.PerMemberCheckIn).Aggregate(item => item.Average()).ClientFooterTemplate("<p>个人平均CheckIn: <#= Average #></p>").Format("{0:c}");
        c.Bound(item => item.PerMemberDealIn).Aggregate(item => item.Average()).ClientFooterTemplate("<p>个人平均DealIn: <#= Average #></p>").Format("{0:c}");
        c.Bound(item => item.PerMemberCall).Aggregate(item => item.Average()).ClientFooterTemplate("<p>个人平均Call数量: <#= Average #></p>");
    }).DataBinding(dataBinding => dataBinding.Ajax().Select("_WeekProgress", "report"))
             .Selectable().ClientEvents(events => events.OnRowSelect("onWeekRowSelected"))
                     .ClientEvents(clientEvents => clientEvents.OnDataBinding("onWeeksBinding")).Pageable(p => p.Style(GridPagerStyles.Status).PageOnScroll(true).PageSize(4)).Sortable().Scrollable(s => s.Height(110))
    )
</fieldset>

<fieldset>
    <legend id="ProjectWeektext"></legend>
    @(Html.Telerik().Grid<AjaxWeekProjectProgressStatistics>().Name("projectweek")
     
    .Columns(c =>
    {
        c.Bound(item => item.ProjectName);
        c.Bound(item => item.TotalCheckinTargets).Title("项目总CheckIn目标").Format("{0:c}").Aggregate(item => item.Sum()).ClientFooterTemplate("<p>CheckIn目标总额: <#= Sum #></p>");
        c.Bound(item => item.TotalCheckIn).Title("项目总CheckIn").Format("{0:c}").Aggregate(item => item.Sum()).ClientFooterTemplate("<p>CheckIn总额: <#= Sum #></p>");
        c.Bound(item => item.CheckInComplatePercetage).ClientTemplate("<p><#= CheckInComplatePercetage #>%</p>");
        c.Bound(item => item.TotalDealinTargets).Title("项目总DeaIn目标").Format("{0:c}").Aggregate(item => item.Sum()).ClientFooterTemplate("<p>DealIn目标总额: <#= Sum #></p>");
        c.Bound(item => item.TotalDealIn).Title("项目总DealIn").Format("{0:c}").Aggregate(item => item.Sum()).ClientFooterTemplate("<p>DealIn总额: <#= Sum #></p>");
        c.Bound(item => item.DealInComplatePercetage).ClientTemplate("<p><#= DealInComplatePercetage #>%</p>");
        c.Bound(item => item.MemberCounts);
        c.Bound(item => item.LeadCallsCount).Aggregate(item => item.Sum()).ClientFooterTemplate("<p>Call总数: <#= Sum #></p>");
        c.Bound(item => item.CallingCompanyCount).Aggregate(item => item.Sum()).ClientFooterTemplate("<p>已打公司总数: <#= Sum #></p>");
        c.Bound(item => item.CallingLeadCount).Aggregate(item => item.Sum()).ClientFooterTemplate("<p>已打Lead总数: <#= Sum #></p>");
        c.Bound(item => item.PerMemberCheckIn).Aggregate(item => item.Average()).ClientFooterTemplate("<p>个人平均CheckIn: <#= Average #></p>").Format("{0:c}");
        c.Bound(item => item.PerMemberDealIn).Aggregate(item => item.Average()).ClientFooterTemplate("<p>个人平均DealIn: <#= Average #></p>").Format("{0:c}");
        c.Bound(item => item.PerMemberCall).Aggregate(item => item.Average()).ClientFooterTemplate("<p>个人平均Call数量: <#= Average #></p>");
    }).DataBinding(dataBinding => dataBinding.Ajax().Select("_ProjectWeekProgress", "report"))
     .Selectable().ClientEvents(events => events.OnRowSelect("onWeekRowSelected"))
     .ClientEvents(clientEvents => clientEvents.OnDataBinding("onProjectWeekBinding")).Pageable(p => p.Style(GridPagerStyles.Status).PageOnScroll(true).PageSize(4)).Sortable().Scrollable(s => s.Height(100))
    )
</fieldset>

<fieldset>
    <legend id="MonthProject">@DateTime.Now.Month 月项目进度表</legend>
    @(Html.Telerik().Grid<AjaxMonthProjectProgressStatistics>().Name("projectmonth")
        .DataKeys(keys =>
        {
            keys.Add(s => s.Month);
        })
    .Columns(c =>
    {
        c.Bound(item => item.ProjectName);
        c.Bound(item => item.TotalCheckinTargets).Title("项目总CheckIn目标").Format("{0:c}").Aggregate(item => item.Sum()).ClientFooterTemplate("<p>CheckIn目标总额: <#= Sum #></p>");
        c.Bound(item => item.TotalCheckIn).Title("项目总CheckIn").Format("{0:c}").Aggregate(item => item.Sum()).ClientFooterTemplate("<p>CheckIn总额: <#= Sum #></p>");
        c.Bound(item => item.CheckInComplatePercetage).ClientTemplate("<p><#= CheckInComplatePercetage #>%</p>");
        c.Bound(item => item.TotalDealinTargets).Title("项目总DeaIn目标").Format("{0:c}").Aggregate(item => item.Sum()).ClientFooterTemplate("<p>DealIn目标总额: <#= Sum #></p>");
        c.Bound(item => item.TotalDealIn).Title("项目总DealIn").Format("{0:c}").Aggregate(item => item.Sum()).ClientFooterTemplate("<p>DealIn总额: <#= Sum #></p>");
        c.Bound(item => item.DealInComplatePercetage).ClientTemplate("<p><#= DealInComplatePercetage #>%</p>");
        c.Bound(item => item.MemberCounts);
        c.Bound(item => item.LeadCallsCount).Aggregate(item => item.Sum()).ClientFooterTemplate("<p>Call总数: <#= Sum #></p>");
        c.Bound(item => item.CallingCompanyCount).Aggregate(item => item.Sum()).ClientFooterTemplate("<p>已打公司总数: <#= Sum #></p>");
        c.Bound(item => item.CallingLeadCount).Aggregate(item => item.Sum()).ClientFooterTemplate("<p>已打Lead总数: <#= Sum #></p>");
        c.Bound(item => item.PerMemberCheckIn).Aggregate(item => item.Average()).ClientFooterTemplate("<p>个人平均CheckIn: <#= Average #></p>").Format("{0:c}");
        c.Bound(item => item.PerMemberDealIn).Aggregate(item => item.Average()).ClientFooterTemplate("<p>个人平均DealIn: <#= Average #></p>").Format("{0:c}");
        c.Bound(item => item.PerMemberCall).Aggregate(item => item.Average()).ClientFooterTemplate("<p>个人平均Call数量: <#= Average #></p>");
    }).DataBinding(dataBinding => dataBinding.Ajax().Select("_ProjectMonthProgress", "report"))
     //.Selectable().ClientEvents(events => events.OnRowSelect("onWeekRowSelected"))
    .ClientEvents(clientEvents => clientEvents.OnDataBinding("onMonthProjectBinding")).Pageable(p => p.Style(GridPagerStyles.Status).PageOnScroll(true).PageSize(4)).Sortable().Scrollable(s => s.Height(110))
    )
</fieldset>

<script type="text/javascript">

    var month;

    function onMonthRowSelected(e) {
      
        month = e.row.cells[0].innerHTML;

        $('#MonthWeek').text(month + " 月每周进度");
        $('#MonthProject').text(month + " 月项目进度");
        
        var weeks = $('#weeks').data('tGrid');
        var projectmonth = $('#projectmonth').data('tGrid');
        weeks.rebind();
        projectmonth.rebind();
    }

    function onWeeksBinding(e) {
        e.data = $.extend(e.data, { month: month });
    }

    function onMonthProjectBinding(e) {
        e.data = $.extend(e.data, { month: month });
    }

    var startdate;

    function onWeekRowSelected(e) {
        var projectweek = $('#projectweek').data('tGrid');
        startdate = e.row.cells[0].innerHTML;
        var enddate = e.row.cells[1].innerHTML;
        $('#ProjectWeektext').text(startdate + " ~ " + enddate + "项目进度");
        
        projectweek.rebind();
    }

  
    function onProjectWeekBinding(e) {
        e.data = $.extend(e.data, { startdate: startdate });
    }
    
</script>
@*@using Model
@model List<AjaxViewProjectMonthPerformance>
@Html.Partial("progressselector")
@{
    var selectedangels = ViewBag.SelectedAngels as List<string>;
    foreach (var pv in Model)
    {
        var listm = new List<AjaxViewProjectMonthPerformance>();
        listm.Add(pv);
    <fieldset>
        <legend>@pv.ProjectName </legend>
        @if (selectedangels == null || selectedangels.Contains("week"))
        {
            foreach (AjaxViewProjectWeekPerformance wv in pv.AjaxViewProjectWeekPerformances)
            {
                var m = new List<AjaxViewProjectWeekPerformance>();
                m.Add(wv);
            <fieldset style="width: 22.1%; float: left;">
                <legend>@wv.StartDate.ToShortDateString() ~ @wv.EndDate.ToShortDateString()</legend>
                @(Html.Telerik().Chart<AjaxViewProjectWeekPerformance>(m).Name("chart" + wv.ProjectID + wv.StartDate.ToShortDateString()).Title(wv.ProjectName).Legend(legend => legend.Position(ChartLegendPosition.Bottom)).Series(series =>
  {
      series.Column(s => s.DealInTarget).Name("销售目标").Labels(labels => labels.Format("￥{0:#,##0}").Visible(true));
      series.Column(s => s.DealIn).Name("实际出单").Labels(labels => labels.Format("￥{0:#,##0}").Visible(true));
      series.Column(s => s.CheckInTarget).Name("入账目标").Labels(labels => labels.Format("￥{0:#,##0}").Visible(true));
      series.Column(s => s.CheckIn).Name("实际入账").Labels(labels => labels.Format("￥{0:#,##0}").Visible(true));

      //series.Bar(s => s.DealInTarget).Name("销售目标").Labels(labels => labels.Template(" 销售目标: <#= value #>").Visible(true));
      //series.Bar(s => s.DealIn).Name("实际出单").Labels(labels => labels.Template(" 实际出单: <#= value #>").Visible(true));
      //series.Bar(s => s.CheckInTarget).Name("入账目标").Labels(labels => labels.Template(" 入账目标: <#= value #>").Visible(true));
      //series.Bar(s => s.CheckIn).Name("实际入账").Labels(labels => labels.Template(" 实际入账: <#= value #>").Visible(true));

  })
  .CategoryAxis(axis => axis.Categories(s => s.ComplatePercentage))
      .ValueAxis(axis => axis.Numeric().Labels(labels => labels.Format("￥{0:,###0}")))
      )
            </fieldset> 
            }
        }
 @if (selectedangels == null || selectedangels.Contains("month"))
 {
       @(Html.Telerik().Chart<AjaxViewProjectMonthPerformance>(listm).Name("chart" + pv.ProjectID).Title("月目标完成情况")
        .Legend(legend => legend.Position(ChartLegendPosition.Bottom)).Series(series =>
{
    series.Bar(s => s.DealInTarget).Name("销售目标").Labels(labels => labels.Format("销售目标: ￥{0:#,##0}").Visible(true));
    series.Bar(s => s.DealIn).Name("实际出单").Labels(labels => labels.Format("实际出单: ￥{0:#,##0}").Visible(true));
    series.Bar(s => s.CheckInTarget).Name("入账目标").Labels(labels => labels.Format("入账目标: ￥{0:#,##0}").Visible(true));
    series.Bar(s => s.CheckIn).Name("实际入账").Labels(labels => labels.Format("实际入账: ￥{0:#,##0}").Visible(true));
    //series.Bar(s => s.DealInTarget).Name("销售目标").Labels(labels => labels.Template(" 销售目标: <#= value #>").Visible(true));
}).CategoryAxis(axis => axis.Categories(s => s.ComplatePercentage))
  .ValueAxis(axis => axis.Numeric().Labels(labels => labels.Format("￥{0:#,##0}"))).HtmlAttributes(new { style = "float:left; width:98%;height:250px;" }))
 }

@* @(Html.Telerik().Chart<AjaxViewProjectMonthPerformance>(Model).Name("totalchart" + pv.ProjectID).Title("月目标完成情况比较")
        .Legend(legend => legend.Position(ChartLegendPosition.Bottom)).Series(series => 
{
    series.Column(s => s.DealInTarget).Name("销售目标").Labels(true);
    series.Column(s => s.DealIn).Name("实际出单").Labels(true);
    series.Column(s => s.CheckInTarget).Name("入账目标").Labels(true);
    series.Column(s => s.CheckIn).Name("实际入账").Labels(true);
    //series.Bar(s => s.DealInTarget).Name("销售目标").Labels(labels => labels.Template(" 销售目标: <#= value #>").Visible(true));
}).CategoryAxis(axis => axis.Categories(s => s.ComplatePercentage))
      .ValueAxis(axis => axis.Numeric().Labels(labels => labels.Format("￥{0:#,##0}"))).HtmlAttributes(new { style="float:left; height:250px;"}))


</fieldset>
    }


}*@ 