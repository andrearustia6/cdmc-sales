@model Sales.Model._PreCommission
@using Utl
<style type="text/css">
   
    
    /* in-form editing */
    .t-edit-form-container
    {
         width: 1050px;
        height:350px;
        margin: 1em;
        text-align: right;
    }
   td
   {
       text-align:left;
   }
</style>
<script>
    $("#TargetNameEN option[text='"+TargetNameEN+"']").attr("selected", true);
    
</script>
<script type="text/javascript">

    function OnChange(e) {
        var StartDate = strTodate($("#StartDate").val());
        var DateB = new Date(StartDate.getFullYear(), StartDate.getMonth() + 1, 0); //当月的最后一天
        yy = DateB.getFullYear();
        mm = DateB.getMonth() + 1;
        dd = DateB.getDate();
        datestr = yy + '-' + mm + '-' + dd;
        $("#EndDate").val(datestr);
        var sale = $("#TargetNameEN").find("option:selected").val();
        if (sale == "") {
           return;
        }
        
        
        var month = StartDate.getMonth() + 1;
        $.ajax({
            url: "/Finance/GetIncome",
            type: "post",
            dataType: "json",
            data: { month: month, sale: sale },
            error: function (a, b, c) {
                alert("获取数据失败，请重试。");
            },
            success: function (result) {
                if (result.Data.length > 0) {
                    $("#ProjectNames").val(result.Data[0].ProjectNames);
                    $("#TargetNameCN").val(result.Data[0].TargetNameCN);
                    $("#TargetNameEN").val(result.Data[0].TargetNameEN);
                    $("#InOut").val(result.Data[0].InOut);
                    $("#DelegateLessCountStr").val(result.Data[0].DelegateLessCountStr);
                    $("#DelegateLessIncomeStr").val(result.Data[0].DelegateLessIncomeStr);
                    $("#DelegateMoreCountStr").val(result.Data[0].DelegateMoreCountStr);
                    $("#DelegateMoreIncomeStr").val(result.Data[0].DelegateMoreIncomeStr);
                    $("#SponsorIncomeStr").val(result.Data[0].SponsorIncomeStr);
                    $("#IncomeStr").val(result.Data[0].IncomeStr);

                    $("#DelegateLessCount").val(result.Data[0].DelegateLessCount);
                    $("#DelegateLessIncome").val(result.Data[0].DelegateLessIncome);
                    $("#DelegateMoreCount").val(result.Data[0].DelegateMoreCount);
                    $("#DelegateMoreIncome").val(result.Data[0].DelegateMoreIncome);
                    $("#SponsorIncome").val(result.Data[0].SponsorIncome);
                    $("#Income").val(result.Data[0].Income);
                }
                else
                    alert("没有入账信息");
            }
        });
    }
    function OnRateChange(e) {
        $("#Commission").val($("#Income").val() * $("#CommissionRate").val() / 100)
       
        calc();
    }
    function OnTaxChange(e) {
        calc();
    }
    function OnBonusChange(e) {
        calc();
    }
    function OnReturnIncomeChange(e) {
        calc();
    }

    function calc() {
        
        var commission = $("#Commission").val();
        var bonus = $("#Bonus").val();
        var tax = $("#Tax").val();
        var returnincome = $("#ReturnIncome").val();

        $("#ActualCommission").val(commission - bonus - tax - returnincome);
        //alert(("#ActualCommission").parent().find(".t-formatted-value").val());
    }
    function strTodate(strr) {
        strr1 = strr.split(' ');
        datestr = strr1[0];
        strr2 = datestr.split('-');
        date1 = new Date(strr2[0], strr2[1] - 1, strr2[2]);
        return date1;
    }
   
</script>

<div style=" padding-bottom:20px;width:100%"> 
@Html.HiddenFor(model => model.ID)
@Html.HiddenFor(model => model.DelegateLessIncome)
@Html.HiddenFor(model => model.DelegateMoreIncome)
@Html.HiddenFor(model => model.SponsorIncome)
@Html.HiddenFor(model => model.Income)
    <legend  style="text-align:left">提成预发表</legend>

   <table style="width:100%" >
    <tr>
        <td  style="width:20%">
            开始时间
        </td>
        <td>
            @Html.Telerik().DatePickerFor(model => model.StartDate).ClientEvents(e => e.OnChange("OnChange"))
            @Html.ValidationMessageFor(model => model.StartDate)
        </td>
        <td  style="width:20%">
            结束时间
        </td>
        <td>
            @Html.Telerik().DatePickerFor(model => model.EndDate)
            @Html.ValidationMessageFor(model => model.EndDate)
        </td>
        <td  style="width:20%">
            英文名
        </td>
        <td>
            @Html.DropDownListFor(model => model.TargetNameEN, BLL.Finance_Logical._PreCommissionBLL.GetSalesDDL(DateTime.Now.Month), "请选择")
            @Html.ValidationMessageFor(model => model.TargetNameEN)
        </td>
        <td  style="width:20%">
            中文名
        </td>
        <td>
             @Html.TextBoxFor(model => model.TargetNameCN, new { READONLY = "readonly", style = "border:none;" })
        </td>
    </tr>
    <tr>
        <td>
            @Html.LabelFor(model => model.ProjectNames)
        </td>
        <td colspan="3">
            @Html.TextBoxFor(model => model.ProjectNames, new { READONLY = "readonly", style = "border:none;width:100%" })
        </td>
        <td>
            @Html.LabelFor(model => model.InOut)
        </td>
        <td >
            @Html.TextBoxFor(model => model.InOut, new { READONLY = "readonly", style = "border:none;" })
        </td>
        <td>
            @Html.LabelFor(model => model.SponsorIncome)
        </td>
        <td >
        
            ￥@Html.TextBoxFor(model => model.SponsorIncomeStr, new { READONLY = "readonly", style = "border:none;width:50%" })
        </td>
    </tr>
    <tr>
        
        <td>
         小于3000金额
        </td>
        <td >
        ￥@Html.TextBoxFor(model => model.DelegateLessIncomeStr, new { READONLY = "readonly", style = "border:none;width:50%" })
        </td>
        <td>
            大于3000人数
        </td>
        <td>
            @Html.TextBoxFor(model => model.DelegateMoreCount, new { READONLY = "readonly", style = "border:none;" })
        </td>
        <td>
        大于3000金额
        </td>
        <td>
        ￥@Html.TextBoxFor(model => model.DelegateMoreIncomeStr, new { READONLY = "readonly", style = "border:none;width:50%" })
        </td>
        <td>
            @Html.LabelFor(model => model.Income)
        </td>
        <td>
            ￥@Html.TextBoxFor(model => model.IncomeStr, new { READONLY = "readonly", style = "border:none;width:50%" })
        </td>
    </tr>
    <tr>
        <td>
         @Html.LabelFor(model => model.CommissionRate)
        </td>
        <td>
        @Html.TextBoxFor(model => model.CommissionRate)
        </td>
        <td>
            @Html.LabelFor(model => model.Commission)
        </td>
        <td>
        ￥@Html.TextBoxFor(model => model.Commission, new { READONLY = "readonly", style = "border:none;width:50%" }) 
        </td>
        <td>
         @Html.LabelFor(model => model.Tax)
        </td>
        <td>
        @Html.Telerik().CurrencyTextBoxFor(model => model.Tax).ClientEvents(e => e.OnChange("OnTaxChange"))
        </td>
        <td>
            @Html.LabelFor(model => model.Bonus)
        </td>
        <td>
            @Html.Telerik().CurrencyTextBoxFor(model => model.Bonus).ClientEvents(e => e.OnChange("OnBonusChange"))
        </td>
    </tr>
    <tr>
        <td>
         @Html.LabelFor(model => model.ReturnIncome)
        </td>
        <td>
        @Html.Telerik().CurrencyTextBoxFor(model => model.ReturnIncome).ClientEvents(e => e.OnChange("OnReturnIncomeChange"))
        </td>
        <td>
            @Html.LabelFor(model => model.ReturnReason)
        </td>
        <td colspan="3">
            @Html.TextAreaFor(model => model.ReturnReason)
        </td>
        <td>
         @Html.LabelFor(model => model.ActualCommission)
        </td>
        <td>
        ￥@Html.TextBoxFor(model => model.ActualCommission, new { READONLY = "readonly", style = "border:none;width:50%" })
        </td>
    </tr>
    <tr>
    <td colspan="4" style="color:Red">
    海外销售提成：提成额=入账总额 * 5%
    
    </td>
    <td colspan="4" style="color:Red">
    国内销售提成：(入账总额-3000) * 15%
    </td>
    </tr>
    <tr>
    <td colspan="8" style="color:Red">
    计算公式：实际提成=入账总额 * 提成比例 - 扣税 - 扣奖金 - 冲销金额
    </td>
    </tr>
</table>
</div>
<div style=" padding-bottom:40px;width:100%"> 

</div>
<script type="text/javascript">
    //页面加载后设置币种的默认值
    $(function () {
        $("#TargetNameEN").change(function () {
            var sale = $("#TargetNameEN").find("option:selected").val();
            if ($("#StartDate").val() == "") {
                alert("请选择开始时间");
                $("#TargetNameEN option[text='请选择']").attr("selected", true);
                return;
            }
            var StartDate = new Date($("#StartDate").val());
            var month = StartDate.getMonth() + 1;
            $.ajax({
                url: "/Finance/GetIncome",
                type: "post",
                dataType: "json",
                data: { month: month, sale: sale },
                error: function (a, b, c) {
                    alert("获取数据失败，请重试。");
                },
                success: function (result) {
                    if (result.Data.length > 0) {
                        $("#ProjectNames").val(result.Data[0].ProjectNames);
                        $("#TargetNameCN").val(result.Data[0].TargetNameCN);
                        $("#TargetNameEN").val(result.Data[0].TargetNameEN);
                        $("#InOut").val(result.Data[0].InOut);
                        $("#DelegateLessCountStr").val(result.Data[0].DelegateLessCountStr);
                        $("#DelegateLessIncomeStr").val(result.Data[0].DelegateLessIncomeStr);
                        $("#DelegateMoreCountStr").val(result.Data[0].DelegateMoreCountStr);
                        $("#DelegateMoreIncomeStr").val(result.Data[0].DelegateMoreIncomeStr);
                        $("#SponsorIncomeStr").val(result.Data[0].SponsorIncomeStr);
                        $("#IncomeStr").val(result.Data[0].IncomeStr);

                        $("#DelegateLessCount").val(result.Data[0].DelegateLessCount);
                        $("#DelegateLessIncome").val(result.Data[0].DelegateLessIncome);
                        $("#DelegateMoreCount").val(result.Data[0].DelegateMoreCount);
                        $("#DelegateMoreIncome").val(result.Data[0].DelegateMoreIncome);
                        $("#SponsorIncome").val(result.Data[0].SponsorIncome);
                        $("#Income").val(result.Data[0].Income);

                        if (result.Data[0].InOut == "国内") {
                            //$("#Commission").val((result.Data[0].Income - 3000) * 0.15);
                            $("#CommissionRate").val(5);
                            $("#Commission").val(result.Data[0].Income * 0.05);
                        }
                        else {
                            $("#CommissionRate").val(5);
                            $("#Commission").val(result.Data[0].Income * 0.05);
                        }
                    }
                    else
                        alert("没有入账信息");

                }
            });
        });
        $("#CommissionRate").change(function () {
            $("#Commission").val($("#Income").val() * $("#CommissionRate").val() / 100)
            calc();
        });
    });
//    var datepicker = $('#cEndDate').data('tDatePicker');
//    alert(datepicker);
//    datepicker.val(new Date('1/1/2012'));
</script>
