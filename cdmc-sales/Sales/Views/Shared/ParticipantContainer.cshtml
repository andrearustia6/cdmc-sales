@using Utl
@using Entity
@model Deal
<div>
    @if (Model.Participants.Count > 0)
    {
        <fieldset style="width: 80%;">
            <legend>参会客户列表</legend>
            <div class="participantLists">
                @Html.Partial("Participants", Model.Participants)
            </div>
        </fieldset>
    }
    <fieldset style="width: 80%; margin: 0px 0px 0px 0px;">
        <legend>添加新的客户</legend>
        <center>
            <div class="inputmessageaddparticipant">
                @Html.Partial("PageMessage", string.Empty)
            </div>
            <div class="addParticipant" style="margin: 0px 0px 0px 0px;">
                <table style="width:100%;">
                    <tr>
                        <td>
                            客户名称：@Html.TextBox("Name")<font style="color: Red">*</font>
                        </td>
                        <td>
                            客户职位：@Html.TextBox("Title")
                        </td>
                        <td>
                            客户性别：@Html.DropDownList("Gender", new SelectList(new List<string>() { "Mr", "Mrs" }, "-请选择-"))
                        </td>
                    </tr>
                    <tr>
                        <td>
                            移动电话：@Html.TextBox("Mobile")
                        </td>
                        <td>
                            客户直线：@Html.TextBox("Contact")
                        </td>
                        <td>
                            电子邮箱：@Html.TextBox("Email")
                        </td>
                    </tr>
                    <tr>
                        <td>
                            参会类型：@Html.DropDownList("ParticipantTypeID", new SelectList(CH.GetAllData<ParticipantType>(), "ID", "Name"), "-请选择-")<font
                                style="color: Red">*</font>
                        </td>
                        <td>
                            @if(Model.CompanyRelationship.Company.DistrictNumberID==null)
                            {
                                <span>国内邮编：</span>
                            @Html.TextBox("ZIP")<font style="color: Red">*</font>
                            }
                        </td>
                        <td>
                            @if(Model.CompanyRelationship.Company.DistrictNumberID==null)
                            {
                                <span>国内地址：</span>
                            @Html.TextBox("Address")<font style="color: Red">*</font>
                            }
                        </td>
                    </tr>
                    <tr>
                        <td>
                            公司Lead：
                            @if (Model.CompanyRelationship.CompanyID != null)
                            {
                                @Html.DropDownList("CompanyLeadID", SelectHelper.CompanyLeadsSelectList((int)Model.CompanyRelationship.CompanyID), "- 请选择 -", new { onchange = "onLeadSelected(this.value)" })
                            }
                        </td>
                    </tr>
                </table>
                <center>
                    <input type="button" id="addparticipant" style="margin: 20px;" value=" 添加新客户 " />
                </center>
                @Html.Hidden("ProjectID", Model.ProjectID)
                @Html.Hidden("DealID", Model.ID)
                @Html.Hidden("CRMID", Model.CompanyRelationshipID)
                @Html.Hidden("CompanyID", Model.CompanyRelationship.Company.ID)
            </div>
        </center>
    </fieldset>

</div>
<script type="text/javascript" language="javascript">
    function onLeadSelected(leadid) {
        if (leadid != null && leadid != "") {
            $.ajax({
                url: "/Sales/GetLeadById",
                type: "post",
                data: { id: leadid },
                error: function () {
                    alert("获取Lead信息失败");
                },
                success: function (data) {
                    var leadstring = data;
                    var lead = new Array();
                    lead = leadstring.split(",");

                    $(".addParticipant #Name").val(lead[0]);
                    $(".addParticipant #Title").val(lead[1]);
                    $(".addParticipant #Gender").val(lead[2]);
                    $(".addParticipant #Mobile").val(lead[3]);
                    $(".addParticipant #Contact").val(lead[4]);
                    $(".addParticipant #Email").val(lead[5]);
                    $(".addParticipant #ZIP").val(lead[6]);
                    $(".addParticipant #Address").val(lead[7]);
                }
            });
        } else {
            $(".addParticipant #Name").val();
            $(".addParticipant #Title").val();
            $(".addParticipant #Gender").val();
            $(".addParticipant #Mobile").val();
            $(".addParticipant #Contact").val();
            $(".addParticipant #Email").val();
            $(".addParticipant #ZIP").val();
            $(".addParticipant #Address").val();
        }
    }
</script>