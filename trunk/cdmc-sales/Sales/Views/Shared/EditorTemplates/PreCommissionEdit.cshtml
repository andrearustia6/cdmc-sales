@model Sales.Model._PreCommission
@using Utl
<style type="text/css">
   
    
    /* in-form editing */
    .t-edit-form-container
    {
         width: 1050px;
        height:250px;
        margin: 1em;
        text-align: right;
    }
   td
   {
       text-align:left;
   }
</style>
@*<script>
//    var popup = $("#PreCommissionPopUp");
//    popup.css({ "top": "20px" });

    var popup = $("#PreCommissionPopUp");
    var popupDataWin = popup.data("tWindow");
    var l = ($(window).width() / 2 - $(popup).width() / 2);
    popup.css({ "left": l + "px", "margin-left": "0", "width": $(popup).width() });
</script>*@
<script type="text/javascript">

    function OnChange(e) {
    }
    function OnRateChange(e) {

        $("#Commission").val($("#Income").val() * $("#CommissionRate").val() / 100)
        calc();
    }
    function OnTaxChange(e) {
        calc();
    }
    function OnBonusChange(e) {
        calc();
    }
    function OnReturnIncomeChange(e) {
        calc();
    }

    function calc() {
        var commission = $("#Commission").val();
        var bonus = $("#Bonus").val();
        var tax = $("#Tax").val();
        var returnincome = $("#ReturnIncome").val();
        $("#ActualCommission").val(commission - bonus - tax - returnincome);
    }
</script>

<div style=" padding-bottom:40px;width:100%"> 
@Html.HiddenFor(m=>m.ID)
 @{if (Model.ID != 0)
   {
            <legend  style="text-align:left">编辑提成预发表</legend>
   }
   else
   {
            <legend  style="text-align:left">新增提成预发表</legend>
   }
        }
 @{if (Model.ID == 0)
   {
   <table style="width:100%" >
    <tr>
        <td  style="width:20%">
            开始时间
        </td>
        <td>
            @Html.Telerik().DatePickerFor(model => model.StartDate).Value(Model.ID == 0 ? DateTime.Now.StartOfMonth() : Model.StartDate).ClientEvents(e => e.OnChange("OnChange").OnLoad("OnChange")).Format("yyyy/M/d")
        </td>
        <td  style="width:20%">
            结束时间
        </td>
        <td>
            @Html.Telerik().DatePickerFor(model => model.EndDate).Value(Model.ID == 0 ? DateTime.Now.EndOfMonth() : Model.EndDate).Format("yyyy/M/d")
        </td>
        <td  style="width:20%">
            目标
        </td>
        <td>
            @Html.DropDownList("sales", BLL.Finance_Logical._PreCommissionBLL.GetSalesDDL(DateTime.Now.Month), "请选择")
        </td>
        <td  style="width:20%">
            中文名
        </td>
        <td>
             @Html.TextBoxFor(model => model.TargetNameCN)
        </td>
    </tr>
    <tr>
        <td>
            @Html.LabelFor(model => model.ProjectNames)
        </td>
        <td colspan="3">
            @Html.TextBoxFor(model => model.ProjectNames, new { @style = "width:100%" })
        </td>
        <td>
            @Html.LabelFor(model => model.InOut)
        </td>
        <td >
            @Html.TextBoxFor(model => model.InOut)
        </td>
        <td>
            @Html.LabelFor(model => model.SponsorIncome)
        </td>
        <td >
            @Html.TextBoxFor(model => model.SponsorIncome)
        </td>
    </tr>
    <tr>
        <td>
            @Html.LabelFor(model => model.DelegateLessCount)
        </td>
        <td>
            @Html.TextBoxFor(model => model.DelegateLessCount)
        </td>
        <td>
         @Html.LabelFor(model => model.DelegateLessIncome)
        </td>
        <td>
        @Html.TextBoxFor(model => model.DelegateLessIncome)
        </td>
        <td>
            @Html.LabelFor(model => model.DelegateMoreCount)
        </td>
        <td>
            @Html.TextBoxFor(model => model.DelegateMoreCount)
        </td>
        <td>
         @Html.LabelFor(model => model.DelegateMoreIncome)
        </td>
        <td>
        @Html.TextBoxFor(model => model.DelegateMoreIncome)
        </td>
    </tr>
    <tr>
        <td>
            @Html.LabelFor(model => model.Income)
        </td>
        <td>
            @Html.TextBoxFor(model => model.Income)
        </td>
        <td>
         @Html.LabelFor(model => model.CommissionRate)
        </td>
        <td>
        @Html.Telerik().NumericTextBoxFor(model => model.CommissionRate).ClientEvents(e => e.OnChange("OnRateChange"))
        </td>
        <td>
            @Html.LabelFor(model => model.Commission)
        </td>
        <td>
            @Html.TextBoxFor(model => model.Commission)
        </td>
        <td>
         @Html.LabelFor(model => model.Tax)
        </td>
        <td>
        @Html.Telerik().NumericTextBoxFor(model => model.Tax).ClientEvents(e => e.OnChange("OnTaxChange"))
        </td>
    </tr>
    <tr>
        <td>
            @Html.LabelFor(model => model.Bonus)
        </td>
        <td>
            @Html.Telerik().NumericTextBoxFor(model => model.Bonus).ClientEvents(e => e.OnChange("OnBonusChange"))
        </td>
        <td>
         @Html.LabelFor(model => model.ReturnIncome)
        </td>
        <td>
        @Html.Telerik().NumericTextBoxFor(model => model.ReturnIncome).ClientEvents(e => e.OnChange("OnReturnIncomeChange"))
        </td>
        <td>
            @Html.LabelFor(model => model.ReturnReason)
        </td>
        <td>
            @Html.TextBoxFor(model => model.ReturnReason)
        </td>
        <td>
         @Html.LabelFor(model => model.ActualCommission)
        </td>
        <td>
        @Html.TextBoxFor(model => model.ActualCommission)
        </td>
    </tr>
</table>
   }
   else
   {
   <table style="width:100%" >
    <tr>
        <td  style="width:20%">
            开始时间
        </td>
        <td>
            @Html.Telerik().DatePickerFor(model => model.StartDate).Value(Model.ID == 0 ? DateTime.Now.StartOfMonth() : Model.StartDate).ClientEvents(e => e.OnChange("OnChange").OnLoad("OnChange")).Format("yyyy/M/d")
        </td>
        <td  style="width:20%">
            结束时间
        </td>
        <td>
            @Html.Telerik().DatePickerFor(model => model.EndDate).Value(Model.ID == 0 ? DateTime.Now.EndOfMonth() : Model.EndDate).Format("yyyy/M/d")
        </td>
        <td  style="width:20%">
            目标
        </td>
        <td>
            @Html.DropDownList("sales", BLL.Finance_Logical._PreCommissionBLL.GetSalesDDL(DateTime.Now.Month), "请选择")
        </td>
        <td  style="width:20%">
            中文名
        </td>
        <td>
             @Html.TextBoxFor(model => model.TargetNameCN)
        </td>
    </tr>
    <tr>
        <td>
            @Html.LabelFor(model => model.ProjectNames)
        </td>
        <td colspan="3">
            @Html.TextBoxFor(model => model.ProjectNames, new { @style = "width:100%" })
        </td>
        <td>
            @Html.LabelFor(model => model.InOut)
        </td>
        <td >
            @Html.TextBoxFor(model => model.InOut)
        </td>
        <td>
            @Html.LabelFor(model => model.SponsorIncome)
        </td>
        <td >
            @Html.TextBoxFor(model => model.SponsorIncome)
        </td>
    </tr>
    <tr>
        <td>
            @Html.LabelFor(model => model.DelegateLessCount)
        </td>
        <td>
            @Html.TextBoxFor(model => model.DelegateLessCount)
        </td>
        <td>
         @Html.LabelFor(model => model.DelegateLessIncome)
        </td>
        <td>
        @Html.TextBoxFor(model => model.DelegateLessIncome)
        </td>
        <td>
            @Html.LabelFor(model => model.DelegateMoreCount)
        </td>
        <td>
            @Html.TextBoxFor(model => model.DelegateMoreCount)
        </td>
        <td>
         @Html.LabelFor(model => model.DelegateMoreIncome)
        </td>
        <td>
        @Html.TextBoxFor(model => model.DelegateMoreIncome)
        </td>
    </tr>
    <tr>
        <td>
            @Html.LabelFor(model => model.Income)
        </td>
        <td>
            @Html.TextBoxFor(model => model.Income)
        </td>
        <td>
         @Html.LabelFor(model => model.CommissionRate)
        </td>
        <td>
        @Html.Telerik().NumericTextBoxFor(model => model.CommissionRate).ClientEvents(e => e.OnChange("OnRateChange"))
        </td>
        <td>
            @Html.LabelFor(model => model.Commission)
        </td>
        <td>
            @Html.TextBoxFor(model => model.Commission)
        </td>
        <td>
         @Html.LabelFor(model => model.Tax)
        </td>
        <td>
        @Html.Telerik().NumericTextBoxFor(model => model.Tax).ClientEvents(e => e.OnChange("OnTaxChange"))
        </td>
    </tr>
    <tr>
        <td>
            @Html.LabelFor(model => model.Bonus)
        </td>
        <td>
            @Html.Telerik().NumericTextBoxFor(model => model.Bonus).ClientEvents(e => e.OnChange("OnBonusChange"))
        </td>
        <td>
         @Html.LabelFor(model => model.ReturnIncome)
        </td>
        <td>
        @Html.Telerik().NumericTextBoxFor(model => model.ReturnIncome).ClientEvents(e => e.OnChange("OnReturnIncomeChange"))
        </td>
        <td>
            @Html.LabelFor(model => model.ReturnReason)
        </td>
        <td>
            @Html.TextBoxFor(model => model.ReturnReason)
        </td>
        <td>
         @Html.LabelFor(model => model.ActualCommission)
        </td>
        <td>
        @Html.TextBoxFor(model => model.ActualCommission)
        </td>
    </tr>
</table>
   }
 }

</div>

<script type="text/javascript">
    //页面加载后设置币种的默认值
    $(function () {
        $("#sales").change(function () {
            var sale = $("#sales").find("option:selected").val();
            var StartDate = new Date($("#StartDate").val());
            var month = StartDate.getMonth()+1;
            $.ajax({
                url: "/Finance/GetIncome",
                type: "post",
                dataType: "json",
                data: { month:month,sale: sale },
                error: function (a, b, c) {
                    alert("获取数据失败，请重试。");
                },
                success: function (result) {

                    $("#ProjectNames").val(result.Data[0].ProjectNames);
                    $("#TargetNameCN").val(result.Data[0].TargetNameCN);
                    $("#TargetNameEN").val(result.Data[0].TargetNameEN);
                    $("#InOut").val(result.Data[0].InOut);
                    $("#DelegateLessCount").val(result.Data[0].DelegateLessCount);
                    $("#DelegateLessIncome").val(result.Data[0].DelegateLessIncome);
                    $("#DelegateMoreCount").val(result.Data[0].DelegateMoreCount);
                    $("#DelegateMoreIncome").val(result.Data[0].DelegateMoreIncome);
                    $("#SponsorIncome").val(result.Data[0].SponsorIncome);
                    $("#Income").val(result.Data[0].Income);
                }
            });
        });
    });
   
</script>
