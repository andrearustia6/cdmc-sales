@{
    ViewBag.Title = "Index";
}

@using Model

@(Html.Telerik().Grid<AjaxCRM>().Name("companyGrid")

    .Columns(c =>
    {
        c.Bound(item => item.CompanyID).Visible(false);
        c.Bound(item => item.CompanyName).Visible(false);
        c.Bound(item => item.CompanyContact).Visible(false);
        c.Bound(item => item.CompanyFax).Visible(false);
        c.Bound(item => item.CompanyDistrictNumberString).Visible(false);
        c.Bound(item => item.Progressstring).Visible(false);

        c.Bound(item => item.LeadID).Visible(false);
        c.Bound(item => item.LeadName).Visible(false);
        c.Bound(item => item.LeadContact).Visible(false);
        c.Bound(item => item.LeadDistinctNumberString).Visible(false);
        c.Bound(item => item.LeadEmail).Visible(false);
        c.Bound(item => item.LeadMobile).Visible(false);
        c.Bound(item => item.LeadFax).Visible(false);
        c.Bound(item => item.LeadTitle).Visible(false);

        //c.Bound(item => item.AjaxCalls);
    })
        .ClientEvents(events => events.OnRowDataBound("onRowDataBound"))
    .ClientRowTemplate(grid =>
            Html.Partial("SalesExItem").ToHtmlString()
        )
         .DetailView(details => details.ClientTemplate(
                Html.Telerik().Grid<AjaxCall>()
                                     .Name("calls_<#= LeadID #>")
                                    .Columns(columns =>
                                    {
                                        columns.Bound(o => o.CallType).Width(80);
                                        columns.Bound(o => o.CallBackDate).Width(100);
                                        columns.Bound(o => o.CallDate).Width(100);
                                        columns.Bound(o => o.Caller).Width(80);
                                        columns.Bound(o => o.Result);
                                    })
                                        .DataBinding(dataBinding => dataBinding.Ajax().Select("_CallIndex", "SalesEx", new { leadid = "<#=LeadID #>" }))
                                                .Pageable(paging => paging.Enabled(false)).Resizable(resizing => resizing.Columns(true))
                                        .Sortable().Scrollable(scrolling => scrolling.Enabled(false))
                                        .Filterable().ToHtmlString()
                ))
    .DataBinding(dataBinding => dataBinding.Ajax().Select("_Index", "SalesEx"))
        .Pageable(paging => paging.Style(GridPagerStyles.Status).PageOnScroll(true).PageSize(10))
           .Scrollable(scrolling => scrolling.Height(450)
            )
       )

<script type="text/javascript">

    function expandRow(grid, row) {
            grid.expandRow(row);
    }

    function onRowDataBound(e) {
        var grid = $(this).data('tGrid');
        expandRow(grid, e.row);
    }
</script>