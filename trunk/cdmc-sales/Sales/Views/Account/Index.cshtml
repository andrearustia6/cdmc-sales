@{
    ViewBag.Title = "个人信息";
}
@model List<MembershipUser>

@using Utl
@using Entity
@Html.Partial("contenttitle","个人信息")
@{
    var dps = CH.GetAllData<Department>();
    Html.Telerik().Grid<MembershipUser>(Model).Name("MembershipUser").ToolBar(commands =>
    {
        if (Employee.AsManager())
        {
            commands.Custom().Text("添加用户").Action("register", "account");
        }
    }
    )

                .DataKeys(keys =>
                {
                    keys.Add(s => s.UserName);
                })
                .Columns(c =>
                {
                    c.Bound(item => item.UserName).Title("用户名称").Width(200);
                    c.Bound(item => item.Email).Title("电子邮箱").Width(200);

                    c.Bound(item => item.UserName).Template(@<span>
                     @{
                         var departmentid = @Employee.GetProfile("DepartmentID", item.UserName) as int?;
                         if (departmentid != null)
                         {
                             var dp = dps.FirstOrDefault(d => d.ID == departmentid);
                             if (dp != null)
                             {
                                 <p>@dp.Name</p>
                             }
                         }
                        }
                    </span>).Width(100).Title("部门");
                    c.Bound(item => item.UserName).Template(@<span>
                        @Employee.GetProfile("IsActivated", item.UserName)
                    </span>).Width(100).Title("是否激活");
                    c.Bound(item => item.UserName).Template(@<span>
                        @Employee.GetProfile("StartDate", item.UserName)
                    </span>).Width(100).Title("入职时间");
                    c.Bound(item => item.UserName).Title("职级").Width(100).Template(@<span>
                     @Employee.GetRoleName(item.UserName)
                    </span>);
    if(Employee.AsDirector())
    {
                    c.Bound(item => item.UserName).Title("Extension").Width(100).Template(@<span>
                     @Employee.GetProfile("Contact", item.UserName)
                    </span>);
    }
                    // c.Bound(item => ).Width(100);
                    c.Bound(item => item.UserName).Title("操作").Width(150).Template(@<span> 
                    <a href=@Url.Content("~/Account/Details/?name=" + item.UserName) >个人信息</a> 
                     @if (Employee.AsDirector())
                     {
                      <span> | </span><a href=@Url.Content("~/Account/SetRoleLevel/?name=" + item.UserName)>设置权限</a>
                     }
                  
                   </span>);
                })
                                                                  .Resizable(resizing => resizing.Columns(true))
                                                                  .Filterable().Sortable().Groupable()
                                                                  .Pageable(p => p.PageSize(20))
                                                                  .Scrollable(scrolling => scrolling.Height(350)).Render();

                                                                  }




